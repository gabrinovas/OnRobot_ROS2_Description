<?xml version="1.0"?>
<robot xmlns:xacro="http://wiki.ros.org/xacro">

  <!-- ====================== MACRO PRINCIPAL ONROBOT ====================== -->
  <xacro:macro name="onrobot"
    params="
      onrobot_type
      prefix:=''
      sim_gazebo:=false
      use_fake_hardware:=false
      connection_type:=tcp
      device:=/tmp/ttyUR
      ip_address:=192.168.1.1
      port:=502
      device_address:=65
    ">

    <!-- ====================== INCLUSIONES COMUNES ====================== -->
    <xacro:include filename="$(find onrobot_description)/urdf/inc/common_materials.xacro"/>

    <!-- ====================== RG2 ====================== -->
    <xacro:if value="${onrobot_type == 'rg2'}">
      <xacro:include filename="$(find onrobot_description)/urdf/rg2_macro.xacro"/>
      <xacro:onrobot_rg2 prefix="${prefix}"/>
    </xacro:if>

    <!-- ====================== RG6 ====================== -->
    <xacro:if value="${onrobot_type == 'rg6'}">
      <xacro:include filename="$(find onrobot_description)/urdf/rg6_macro.xacro"/>
      <xacro:onrobot_rg6 prefix="${prefix}"/>
    </xacro:if>

    <!-- ====================== 2FG7 ====================== -->
    <xacro:if value="${onrobot_type == '2fg7'}">
      <xacro:include filename="$(find onrobot_description)/urdf/2fg7_macro.xacro"/>
      <xacro:onrobot_2fg7 prefix="${prefix}" onrobot_type="${onrobot_type}"/>
    </xacro:if>

    <!-- ====================== 3FG15 ====================== -->
    <xacro:if value="${onrobot_type == '3fg15'}">
      <xacro:include filename="$(find onrobot_description)/urdf/3fg15_macro.xacro"/>
      <xacro:onrobot_3fg15 prefix="${prefix}"/>
    </xacro:if>

    <!-- ====================== GAZEBO: Plugins y Propiedades ====================== -->
    <xacro:if value="${sim_gazebo}">
      <!-- Gazebo ROS Control Plugin -->
      <gazebo>
        <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">
          <parameters>$(find onrobot_description)/config/gazebo_controllers.yaml</parameters>
        </plugin>
      </gazebo>

      <!-- Para 2FG7 -->
      <xacro:if value="${onrobot_type == '2fg7'}">
        <xacro:include filename="$(find onrobot_description)/urdf/inc/2fg7_gazebo.xacro"/>
        <xacro:onrobot_2fg7_grasp_plugin prefix="${prefix}"/>
        <xacro:onrobot_2fg7_mimic_plugin prefix="${prefix}"/>
        <xacro:onrobot_2fg7_gazebo_properties prefix="${prefix}"/>
      </xacro:if>

      <!-- Para 3FG15 -->
      <xacro:if value="${onrobot_type == '3fg15'}">
        <xacro:include filename="$(find onrobot_description)/urdf/inc/3fg15_gazebo.xacro"/>
        <xacro:onrobot_3fg15_grasp_plugin prefix="${prefix}"/>
        <xacro:onrobot_3fg15_mimic_plugin prefix="${prefix}"/>
        <xacro:onrobot_3fg15_gazebo_properties prefix="${prefix}"/>
      </xacro:if>
    </xacro:if>

    <!-- ====================== ROS2 CONTROL ====================== -->
    <xacro:if value="${not use_fake_hardware}">
      <ros2_control name="OnRobotGripper" type="system">
        <hardware>
          <xacro:if value="${onrobot_type == '3fg15'}">
            <plugin>onrobot_driver::ThreeFGHardwareInterface</plugin>
          </xacro:if>
          <xacro:elseif value="${onrobot_type == '2fg7'}">
            <plugin>onrobot_driver::TwoFGHardwareInterface</plugin>
          </xacro:elseif>
          <xacro:elseif value="${onrobot_type == 'rg2' or onrobot_type == 'rg6'}">
            <plugin>onrobot_driver::RGHardwareInterface</plugin>
          </xacro:elseif>
          <param name="onrobot_type">${onrobot_type}</param>
          <param name="prefix">${prefix}</param>
          <param name="connection_type">${connection_type}</param>
          <param name="device">${device}</param>
          <param name="ip_address">${ip_address}</param>
          <param name="port">${port}</param>
          <param name="device_address">${device_address}</param>
        </hardware>

        <!-- Joint definitions -->
        <xacro:if value="${onrobot_type == '3fg15'}">
          <joint name="${prefix}finger_diameter">
            <command_interface name="position"/>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
          </joint>
        </xacro:if>
        <xacro:else>
          <joint name="${prefix}finger_width">
            <command_interface name="position"/>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
          </joint>
        </xacro:else>
      </ros2_control>
    </xacro:if>

  </xacro:macro>
</robot>