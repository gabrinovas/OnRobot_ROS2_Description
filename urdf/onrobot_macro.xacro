<?xml version="1.0"?>
<robot xmlns:xacro="http://wiki.ros.org/xacro">

  <!-- ====================== MACRO PRINCIPAL ONROBOT ====================== -->
  <xacro:macro name="onrobot"
    params="
      onrobot_type
      prefix:=''
      sim_gazebo:=false
      use_fake_hardware:=false
      connection_type:=tcp
      device:=/tmp/ttyUR
      ip_address:=192.168.1.1
      port:=502
      device_address:=65
      num_cups:=4
    ">

    <!-- ====================== INCLUSIONES COMUNES ====================== -->
    <xacro:include filename="$(find onrobot_description)/urdf/inc/common_materials.xacro"/>

    <!-- ====================== RG2 ====================== -->
    <xacro:if value="${onrobot_type == 'rg2'}">
      <xacro:include filename="$(find onrobot_description)/urdf/rg2_macro.xacro"/>
      <xacro:onrobot_rg2 prefix="${prefix}"/>
    </xacro:if>

    <!-- ====================== RG6 ====================== -->
    <xacro:if value="${onrobot_type == 'rg6'}">
      <xacro:include filename="$(find onrobot_description)/urdf/rg6_macro.xacro"/>
      <xacro:onrobot_rg6 prefix="${prefix}"/>
    </xacro:if>

    <!-- ====================== 2FG7 / 2FG14 ====================== -->
    <xacro:if value="${onrobot_type == '2fg7' or onrobot_type == '2fg14'}">
      <xacro:include filename="$(find onrobot_description)/urdf/2fg7_macro.xacro"/>
      <xacro:onrobot_2fg7 prefix="${prefix}" onrobot_type="${onrobot_type}"/>
    </xacro:if>

    <!-- ====================== 3FG15 ====================== -->
    <xacro:if value="${onrobot_type == '3fg15'}">
      <xacro:include filename="$(find onrobot_description)/urdf/3fg15_macro.xacro"/>
      <xacro:onrobot_3fg15 prefix="${prefix}"/>
    </xacro:if>

    <!-- ====================== VG10 (legacy) ====================== -->
    <xacro:if value="${onrobot_type == 'vg10'}">
      <xacro:include filename="$(find onrobot_description)/urdf/vg_macro.xacro"/>
      <xacro:onrobot_vg prefix="${prefix}" onrobot_type="vg10" num_cups="${num_cups}"/>
    </xacro:if>

    <!-- ====================== VGC10 ====================== -->
    <xacro:if value="${onrobot_type == 'vgc10'}">
      <xacro:include filename="$(find onrobot_description)/urdf/vg_macro.xacro"/>
      <xacro:include filename="$(find onrobot_description)/urdf/vgc10_gazebo.xacro"/>
      <xacro:onrobot_vg prefix="${prefix}" onrobot_type="vgc10" num_cups="${num_cups}"/>
    </xacro:if>

    <!-- ====================== GAZEBO: Plugins y Propiedades ====================== -->
    <xacro:if value="${sim_gazebo}">
      <!-- Solo para 2FG7 (pinzas) -->
      <xacro:if value="${onrobot_type == '2fg7' or onrobot_type == '2fg14'}">
        <xacro:include filename="$(find onrobot_description)/urdf/2fg7_gazebo.xacro"/>
        <xacro:onrobot_2fg7_grasp_plugin prefix="${prefix}"/>
        <xacro:onrobot_2fg7_mimic_plugin prefix="${prefix}"/>
        <xacro:onrobot_2fg7_gazebo_properties prefix="${prefix}"/>
      </xacro:if>

      <!-- Solo para VGC10 (vacío) -->
      <xacro:if value="${onrobot_type == 'vgc10'}">
        <xacro:onrobot_vgc10_vacuum_plugin prefix="${prefix}" num_cups="${num_cups}"/>
        <xacro:onrobot_vgc10_gazebo_properties prefix="${prefix}"/>
      </xacro:if>
    </xacro:if>

    <!-- ====================== ROS2 CONTROL (REAL) ====================== -->
    <xacro:unless value="${use_fake_hardware}">
      <ros2_control name="OnRobotGripper" type="actuator">
        <hardware>
          <!-- 2FG7 / 2FG14 -->
          <xacro:if value="${onrobot_type == '2fg7' or onrobot_type == '2fg14'}">
            <plugin>onrobot_driver::TwoFGHardwareInterface</plugin>
            <param name="onrobot_type">${onrobot_type}</param>
          </xacro:if>

          <!-- 3FG15 -->
          <xacro:if value="${onrobot_type == '3fg15'}">
            <plugin>onrobot_driver::ThreeFGHardwareInterface</plugin>
            <param name="onrobot_type">${onrobot_type}</param>
          </xacro:if>

          <!-- RG2 / RG6 -->
          <xacro:if value="${onrobot_type == 'rg2' or onrobot_type == 'rg6'}">
            <plugin>onrobot_driver::RGHardwareInterface</plugin>
            <param name="onrobot_type">${onrobot_type}</param>
          </xacro:if>

          <!-- VGC10 -->
          <xacro:if value="${onrobot_type == 'vgc10'}">
            <plugin>onrobot_driver::VGCHardwareInterface</plugin>
            <param name="onrobot_type">vgc10</param>
          </xacro:if>

          <!-- Parámetros comunes -->
          <param name="prefix">${prefix}</param>
          <param name="connection_type">${connection_type}</param>
          <param name="device">${device}</param>
          <param name="ip_address">${ip_address}</param>
          <param name="port">${port}</param>
          <param name="device_address">${device_address}</param>
          <param name="use_fake_hardware">false</param>
        </hardware>

        <!-- Joint de control (mismo nombre en todos los macros) -->
        <joint name="${prefix}gripper">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
      </ros2_control>
    </xacro:unless>

  </xacro:macro>
</robot>