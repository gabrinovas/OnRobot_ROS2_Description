<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- ================================================================= -->
  <!--  ONROBOT 3FG15 – VERSIÓN FIJA EN MÁXIMA APERTURA + SOLO ROTA EN RZ  -->
  <!--  100% compatible con ROS 2 Humble (sin cos/sin/eval)               -->
  <!--  Diámetro máximo fijo: 117.5 mm                                    -->
  <!-- ================================================================= -->

  <xacro:macro name="onrobot_3fg15" params="prefix">

    <!-- ====================== BASE ====================== -->
    <link name="${prefix}onrobot_base_link">
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="1.2"/>
        <inertia ixx="0.012" ixy="0.0" ixz="0.0" iyy="0.012" iyz="0.0" izz="0.008"/>
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/visual/base.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="onrobot_silver"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/collision/base.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
    </link>

    <!-- =============== MARCO QUE ROTA (solo eje Z) =============== -->
    <link name="${prefix}rotating_frame"/>
    <joint name="${prefix}gripper_rotation" type="revolute">
      <parent link="${prefix}onrobot_base_link"/>
      <child link="${prefix}rotating_frame"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="-3.1416" upper="3.1416" effort="200" velocity="2.0"/>
      <dynamics damping="0.7"/>
    </joint>

    <!-- ====================== DEDO IZQUIERDO ====================== -->
    <link name="${prefix}left_finger_link">
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.08"/>
        <inertia ixx="0.00008" ixy="0.0" ixz="0.0" iyy="0.00008" iyz="0.0" izz="0.00008"/>
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/visual/left_finger.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="onrobot_silver"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/collision/left_finger.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
    </link>
    <joint name="${prefix}left_finger_fixed" type="fixed">
      <parent link="${prefix}rotating_frame"/>
      <child link="${prefix}left_finger_link"/>
      <!-- Máxima apertura: radio = 58.75 mm, ángulo 90° -->
      <origin xyz="0.05875 0 0" rpy="0 0 1.5708"/>
    </joint>

    <!-- ====================== DEDO DERECHO ====================== -->
    <link name="${prefix}right_finger_link">
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.08"/>
        <inertia ixx="0.00008" ixy="0.0" ixz="0.0" iyy="0.00008" iyz="0.0" izz="0.00008"/>
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/visual/right_finger.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="onrobot_silver"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/collision/right_finger.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
    </link>
    <joint name="${prefix}right_finger_fixed" type="fixed">
      <parent link="${prefix}rotating_frame"/>
      <child link="${prefix}right_finger_link"/>
      <!-- 210° → X = -0.029375, Y = -0.050832, rz total = 300° = 5.23599 rad -->
      <origin xyz="-0.029375 -0.050832 0" rpy="0 0 5.23599"/>
    </joint>

    <!-- ====================== DEDO MEDIO ====================== -->
    <link name="${prefix}middle_finger_link">
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.08"/>
        <inertia ixx="0.00008" ixy="0.0" ixz="0.0" iyy="0.00008" iyz="0.0" izz="0.00008"/>
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/visual/middle_finger.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="onrobot_silver"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://onrobot_description/meshes/3fg15/collision/middle_finger.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
    </link>
    <joint name="${prefix}middle_finger_fixed" type="fixed">
      <parent link="${prefix}rotating_frame"/>
      <child link="${prefix}middle_finger_link"/>
      <!-- 330° → X = -0.029375, Y = +0.050832, rz total = 60° = 1.0472 rad -->
      <origin xyz="-0.029375 0.050832 0" rpy="0 0 1.0472"/>
    </joint>

    <!-- ====================== TCP ====================== -->
    <link name="${prefix}gripper_tcp"/>
    <joint name="${prefix}tcp_joint" type="fixed">
      <parent link="${prefix}rotating_frame"/>
      <child link="${prefix}gripper_tcp"/>
      <origin xyz="0 0 0.08" rpy="0 0 0"/>
    </joint>

    <!-- ====================== TRANSMISIÓN (para ROS Control) ====================== -->
    <transmission name="${prefix}gripper_rotation_trans">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${prefix}gripper_rotation">
        <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      </joint>
      <actuator name="${prefix}gripper_rotation_motor">
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>

  </xacro:macro>
</robot>